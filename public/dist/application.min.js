"use strict";var ApplicationConfiguration=function(){var applicationModuleName="marca",applicationModuleVendorDependencies=["ngResource","ngCookies","ngAnimate","ngTouch","ngSanitize","ui.router","ui.bootstrap","ui.utils","ngTable","formly","formlyBootstrap","ngFileUpload","ui.bootstrap.datetimepicker","angularjs-dropdown-multiselect"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("clientes",["core"]),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("derechos",["core"]),ApplicationConfiguration.registerModule("fecvens",["core"]),ApplicationConfiguration.registerModule("feriados",["core"]),ApplicationConfiguration.registerModule("fichas",["core"]),ApplicationConfiguration.registerModule("parametros",["core"]),ApplicationConfiguration.registerModule("subclases",["core"]),ApplicationConfiguration.registerModule("titulars",["core"]),ApplicationConfiguration.registerModule("tramites",["core"]),ApplicationConfiguration.registerModule("ubis",["core"]),ApplicationConfiguration.registerModule("users"),angular.module("clientes").config(["$stateProvider",function($stateProvider){$stateProvider.state("listClientes",{url:"/clientes",templateUrl:"modules/clientes/views/list-clientes.client.view.html"}).state("createCliente",{url:"/clientes/create",templateUrl:"modules/clientes/views/create-cliente.client.view.html"}).state("viewCliente",{url:"/clientes/:clienteId",templateUrl:"modules/clientes/views/view-cliente.client.view.html"}).state("editCliente",{url:"/clientes/:clienteId/edit",templateUrl:"modules/clientes/views/edit-cliente.client.view.html"})}]),angular.module("clientes").controller("ClientesController",["$scope","$stateParams","$location","Authentication","Clientes","TableSettings","ClientesForm",function($scope,$stateParams,$location,Authentication,Clientes,TableSettings,ClientesForm){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Clientes),$scope.cliente={},$scope.setFormFields=function(disabled){$scope.formFields=ClientesForm.getFormFields(disabled)},$scope.create=function(){var cliente=new Clientes($scope.cliente);cliente.$save(function(response){$location.path("clientes/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(cliente){cliente?cliente=Clientes.get({clienteId:cliente._id},function(){cliente.$remove(function(){$scope.tableParams.reload()})}):$scope.cliente.$remove(function(){$location.path("clientes")})},$scope.update=function(){var cliente=$scope.cliente;cliente.$update(function(){$location.path("clientes/"+cliente._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.toViewCliente=function(){$scope.cliente=Clientes.get({clienteId:$stateParams.clienteId}),$scope.setFormFields(!0)},$scope.toEditCliente=function(){$scope.cliente=Clientes.get({clienteId:$stateParams.clienteId}),$scope.setFormFields(!1)},$scope.iniList=function(){$scope.tableParams.parameters({filter:{}})}}]),angular.module("clientes").factory("Clientes",["$resource",function($resource){return $resource("clientes/:clienteId",{clienteId:"@_id"},{update:{method:"PUT"}})}]).directive("dateInput",["dateFilter",function(dateFilter){return{require:"ngModel",template:'<input type="date" class="form-control"></input>',replace:!0,link:function(scope,elm,attrs,ngModelCtrl){ngModelCtrl.$formatters.unshift(function(modelValue){return dateFilter(modelValue,"yyyy-MM-dd")}),ngModelCtrl.$parsers.push(function(modelValue){return angular.toJson(modelValue,!0).substring(1,angular.toJson(modelValue).length-1)})}}}]),angular.module("clientes").factory("ClientesCod",["$resource",function($resource){return $resource("clientes/codigo/:codcli",{codcli:"@codigo"})}]),angular.module("clientes").factory("ClientesBusq",["$resource",function($resource){return $resource("clientes/busq/:texto")}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{className:"row",fieldGroup:[{className:"col-md-2 upper-case",key:"codigo",type:"input",templateOptions:{label:"(*) Código:",disabled:disabled}},{className:"col-md-4 upper-case",key:"nombre",type:"input",templateOptions:{label:"(*) Nombre:",disabled:disabled}},{className:"col-md-2",key:"ruc",type:"input",templateOptions:{label:"Ruc:",disabled:disabled}}]},{key:"direccion",type:"input",templateOptions:{label:"Dirección:",disabled:disabled}},{className:"section-label",template:"<div><strong>UBICACIÓN:</strong></div>"},{className:"row",fieldGroup:[{className:"col-md-2",key:"distrito",type:"input",templateOptions:{label:"Distrito:",disabled:disabled}},{className:"col-md-2",key:"provincia",type:"input",templateOptions:{label:"Pronvicia:",disabled:disabled}},{className:"col-md-2",key:"departamen",type:"input",templateOptions:{label:"Departamento:",disabled:disabled}},{className:"col-md-2",key:"pais",type:"input",templateOptions:{label:"País:",disabled:disabled}}]},{className:"row",fieldGroup:[{className:"col-md-2",key:"telefono",type:"input",templateOptions:{label:"Teléfono:",disabled:disabled}},{className:"col-md-2",key:"fax",type:"input",templateOptions:{label:"Fax:",disabled:disabled}}]},{className:"row",fieldGroup:[{className:"col-md-2",key:"propietari",type:"input",templateOptions:{label:"Propietario:",disabled:disabled}},{className:"col-md-3",key:"e_mail",type:"input",templateOptions:{label:"Email:",disabled:disabled}}]}];return fields},service={getFormFields:getFormFields};return service}angular.module("clientes").factory("ClientesForm",factory)}(),angular.module("core").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Tablas","core","dropdown",""),Menus.addSubMenuItem("topbar","core","Clientes","clientes"),Menus.addSubMenuItem("topbar","core","Titulares","titulars"),Menus.addSubMenuItem("topbar","core","Derechos","derechos"),Menus.addSubMenuItem("topbar","core","Sub Clases","subclases"),Menus.addSubMenuItem("topbar","core","Trámites","tramites"),Menus.addSubMenuItem("topbar","core","Ubicación","ubis"),Menus.addSubMenuItem("topbar","core","Feriados","feriados"),Menus.addSubMenuItem("topbar","core","Parámetros","parametros/config"),Menus.addSubMenuItem("topbar","core","Parámetros Edit","parametros",null,!0,["admin"]),Menus.addSubMenuItem("topbar","core","Fechas de Vencimiento","fecvens",null,!0,["admin"])}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/"),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/views/home.client.view.html"})}]),angular.module("core").controller("HeaderController",["$scope","Authentication","Menus",function($scope,Authentication,Menus){$scope.authentication=Authentication,$scope.isCollapsed=!1,$scope.menu=Menus.getMenu("topbar"),$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","$location","Authentication",function($scope,$location,Authentication){$scope.authentication=Authentication,$scope.init=function(){Authentication.user?$location.path("fichavencimiento"):$location.path("signin")}}]),angular.module("core").directive("capitalizeFirst",["$parse",function($parse){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){var capitalize=function(inputValue){void 0===inputValue&&(inputValue="");var capitalized=inputValue.toUpperCase();return capitalized!==inputValue&&(modelCtrl.$setViewValue(capitalized),modelCtrl.$render()),capitalized};modelCtrl.$parsers.push(capitalize),capitalize($parse(attrs.ngModel)(scope))}}}]),angular.module("core").directive("ngReallyClick",["$modal",function($modal){var ModalInstanceCtrl=["$scope","$modalInstance",function($scope,$modalInstance){$scope.ok=function(){$modalInstance.close()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}];return{restrict:"A",scope:{ngReallyClick:"&"},link:function(scope,element,attrs){element.bind("click",function(){var message=attrs.ngReallyMessage||"¿ Está seguro ?",modalHtml='<div class="modal-body">'+message+"</div>";modalHtml+='<div class="modal-footer"><button class="btn btn-primary" ng-click="ok()">OK</button><button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>';var modalInstance=$modal.open({template:modalHtml,controller:ModalInstanceCtrl});modalInstance.result.then(function(){scope.ngReallyClick()},function(){})})}}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["*"],this.menus={};var shouldRender=function(user){if(!user)return this.isPublic;if(~this.roles.indexOf("*"))return!0;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exists")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,isPublic,roles){return this.menus[menuId]={isPublic:isPublic||!1,roles:roles||this.defaultRoles,items:[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,menuItemTitle,menuItemURL,menuItemType,menuItemUIRoute,isPublic,roles,position){return this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:menuItemTitle,link:menuItemURL,menuItemType:menuItemType||"item",menuItemClass:menuItemType,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].roles:roles,position:position||0,items:[],shouldRender:shouldRender}),this.menus[menuId]},this.addSubMenuItem=function(menuId,rootMenuItemURL,menuItemTitle,menuItemURL,menuItemUIRoute,isPublic,roles,position){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===rootMenuItemURL&&this.menus[menuId].items[itemIndex].items.push({title:menuItemTitle,link:menuItemURL,uiRoute:menuItemUIRoute||"/"+menuItemURL,isPublic:null===isPublic||"undefined"==typeof isPublic?this.menus[menuId].items[itemIndex].isPublic:isPublic,roles:null===roles||"undefined"==typeof roles?this.menus[menuId].items[itemIndex].roles:roles,position:position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].link===menuItemURL&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemURL){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].link===submenuItemURL&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar")}]),function(){function factory(){var _moduloAct="",_initial={count:20,page:1},_settings={counts:[20,50,100]},_moduleConfig={},_moduleParams={},getUrl=function(params,asString){asString=asString||!1;var pairs=asString?[]:{};for(var key in params)if(params.hasOwnProperty(key)){var item=params[key],name=encodeURIComponent(key);if("object"==typeof item){for(var subkey in item)if(!angular.isUndefined(item[subkey])&&""!==item[subkey]){var pname=name+"["+encodeURIComponent(subkey)+"]";asString?pairs.push(pname+"="+item[subkey]):pairs[pname]=item[subkey]}}else angular.isFunction(item)||angular.isUndefined(item)||""===item||(asString?pairs.push(name+"="+encodeURIComponent(item)):pairs[name]=encodeURIComponent(item))}return pairs},getUrlTable=function(params,count,page){_moduleParams[_moduloAct]=params;var config=_moduleConfig[_moduloAct];count?config.count=count:config.count=_initial.count,page?config.page=page:config.page=_initial.page;var local=angular.extend(config,params);return getUrl(local,!1)},getParams=function(){return _moduleParams[_moduloAct]?_moduleParams[_moduloAct]:{}},getSettings=function(modulo){return _moduloAct=modulo,_settings},getConfig=function(){return _moduleConfig[_moduloAct]||(_moduleConfig[_moduloAct]=angular.extend({},_initial)),_moduleConfig[_moduloAct]},getNext=function(){var config=getConfig();config.page=config.page+1;var local=angular.extend(config,getParams());return getUrl(local,!1)},getPrev=function(){var config=getConfig();config.page>1&&(config.page=config.page-1);var local=angular.extend(config,getParams());return getUrl(local,!1)},getEqual=function(){var local=angular.extend(getConfig(),getParams());return getUrl(local,!1)},service={getUrl:getUrl,getUrlTable:getUrlTable,getParams:getParams,getConfig:getConfig,getSettings:getSettings,getNext:getNext,getPrev:getPrev,getEqual:getEqual};return service}angular.module("core").factory("Path",factory)}(),function(){function factory(ngTableParams){var getData=function(Entity){return function($defer,params){params.settings().$scope.$emit("ngTableBeforeReloadData"),Entity.get(params.url(),function(response){params.total(response.total),$defer.resolve(response.results)})}},params={page:1,count:10},settings={total:0,counts:[10,20,30],filterDelay:0},tableParams=new ngTableParams(params,settings),tableParamByType={},getParams=function(Entity,type){return type?(tableParamByType[type]||(tableParamByType[type]=new ngTableParams(params,settings)),tableParamByType[type].settings({getData:getData(Entity)}),tableParamByType[type]):(tableParams.settings({getData:getData(Entity)}),tableParams)},service={getParams:getParams};return service}angular.module("core").factory("TableSettings",factory),factory.$inject=["ngTableParams"]}(),angular.module("derechos").config(["$stateProvider",function($stateProvider){$stateProvider.state("listDerechos",{url:"/derechos",templateUrl:"modules/derechos/views/list-derechos.client.view.html"}).state("createDerecho",{url:"/derechos/create",templateUrl:"modules/derechos/views/create-derecho.client.view.html"}).state("viewDerecho",{url:"/derechos/:derechoId",templateUrl:"modules/derechos/views/view-derecho.client.view.html"}).state("editDerecho",{url:"/derechos/:derechoId/edit",templateUrl:"modules/derechos/views/edit-derecho.client.view.html"})}]),angular.module("derechos").controller("DerechosController",["$scope","$stateParams","$location","Authentication","Derechos","TableSettings","DerechosForm",function($scope,$stateParams,$location,Authentication,Derechos,TableSettings,DerechosForm){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Derechos),$scope.derecho={},$scope.setFormFields=function(disabled){$scope.formFields=DerechosForm.getFormFields(disabled)},$scope.create=function(){var derecho=new Derechos($scope.derecho);derecho.$save(function(response){$location.path("derechos/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(derecho){derecho?derecho=Derechos.get({derechoId:derecho._id},function(){derecho.$remove(function(){$scope.tableParams.reload()})}):$scope.derecho.$remove(function(){$location.path("derechos")})},$scope.update=function(){var derecho=$scope.derecho;derecho.$update(function(){$location.path("derechos/"+derecho._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.toViewDerecho=function(){$scope.derecho=Derechos.get({derechoId:$stateParams.derechoId}),$scope.setFormFields(!0)},$scope.toEditDerecho=function(){$scope.derecho=Derechos.get({derechoId:$stateParams.derechoId}),$scope.setFormFields(!1)}}]),angular.module("derechos").factory("Derechos",["$resource",function($resource){return $resource("derechos/:derechoId",{derechoId:"@_id"},{update:{method:"PUT"}})}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{key:"codigo",type:"input",templateOptions:{label:"Código:",disabled:disabled}},{key:"name",type:"input",templateOptions:{label:"Nombre:",disabled:disabled}}];return fields},service={getFormFields:getFormFields};return service}angular.module("derechos").factory("DerechosForm",factory)}(),angular.module("fecvens").config(["$stateProvider",function($stateProvider){$stateProvider.state("listFecvens",{url:"/fecvens",templateUrl:"modules/fecvens/views/list-fecvens.client.view.html"}).state("createFecven",{url:"/fecvens/create",templateUrl:"modules/fecvens/views/create-fecven.client.view.html"}).state("viewFecven",{url:"/fecvens/:fecvenId",templateUrl:"modules/fecvens/views/view-fecven.client.view.html"}).state("editFecven",{url:"/fecvens/:fecvenId/edit",templateUrl:"modules/fecvens/views/edit-fecven.client.view.html"})}]),angular.module("fecvens").controller("FecvensController",["$scope","$stateParams","$location","Authentication","Fecvens","TableSettings","FecvensForm",function($scope,$stateParams,$location,Authentication,Fecvens,TableSettings,FecvensForm){$scope.authentication=Authentication,$scope.fecven={},$scope.setFormFields=function(disabled){$scope.formFields=FecvensForm.getFormFields(disabled)},$scope.create=function(){var fecven=new Fecvens($scope.fecven);fecven.$save(function(response){$location.path("fecvens/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(fecven){fecven?fecven=Fecvens.get({fecvenId:fecven._id},function(){fecven.$remove(function(){for(var i in $scope.data)$scope.data[i]===fecven&&$scope.data.splice(i,1)})}):$scope.fecven.$remove(function(){$location.path("fecvens")})},$scope.update=function(){var fecven=$scope.fecven;fecven.$update(function(){$location.path("fecvens/"+fecven._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.toViewFecven=function(){$scope.fecven=Fecvens.get({fecvenId:$stateParams.fecvenId}),$scope.setFormFields(!0)},$scope.toEditFecven=function(){$scope.fecven=Fecvens.get({fecvenId:$stateParams.fecvenId}),$scope.setFormFields(!1)},$scope.find=function(){$scope.data=Fecvens.query()}}]),angular.module("fecvens").factory("Fecvens",["$resource",function($resource){return $resource("fecvens/:fecvenId",{fecvenId:"@_id"},{update:{method:"PUT"}})}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{key:"campo",type:"input",templateOptions:{label:"Campo:",disabled:disabled}},{key:"descarte",type:"input",templateOptions:{label:"Campo Descarte",disabled:disabled}},{key:"descripcion",type:"input",templateOptions:{label:"Descripción",disabled:disabled}},{key:"dias",type:"input",templateOptions:{label:"Días",disabled:disabled}}];return fields},service={getFormFields:getFormFields};return service}angular.module("fecvens").factory("FecvensForm",factory)}(),angular.module("feriados").config(["$stateProvider",function($stateProvider){$stateProvider.state("listFeriados",{url:"/feriados",templateUrl:"modules/feriados/views/list-feriados.client.view.html"}).state("createFeriado",{url:"/feriados/create",templateUrl:"modules/feriados/views/create-feriado.client.view.html"}).state("viewFeriado",{url:"/feriados/:feriadoId",templateUrl:"modules/feriados/views/view-feriado.client.view.html"}).state("editFeriado",{url:"/feriados/:feriadoId/edit",templateUrl:"modules/feriados/views/edit-feriado.client.view.html"})}]),angular.module("feriados").controller("FeriadosController",["$scope","$stateParams","$location","Authentication","Feriados","TableSettings","FeriadosForm",function($scope,$stateParams,$location,Authentication,Feriados,TableSettings,FeriadosForm){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Feriados),$scope.feriado={},$scope.setFormFields=function(disabled){$scope.formFields=FeriadosForm.getFormFields(disabled)},$scope.create=function(){var feriado=new Feriados($scope.feriado);feriado.$save(function(response){$location.path("feriados/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(feriado){feriado?feriado=Feriados.get({feriadoId:feriado._id},function(){feriado.$remove(function(){$scope.tableParams.reload()})}):$scope.feriado.$remove(function(){$location.path("feriados")})},$scope.update=function(){var feriado=$scope.feriado;feriado.$update(function(){$location.path("feriados/"+feriado._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.toViewFeriado=function(){$scope.feriado=Feriados.get({feriadoId:$stateParams.feriadoId}),$scope.setFormFields(!0)},$scope.toEditFeriado=function(){$scope.feriado=Feriados.get({feriadoId:$stateParams.feriadoId}),$scope.setFormFields(!1)}}]),angular.module("feriados").factory("Feriados",["$resource",function($resource){return $resource("feriados/:feriadoId",{feriadoId:"@_id"},{update:{method:"PUT"}})}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{className:"row",fieldGroup:[{className:"col-md-1",key:"dia",type:"input",templateOptions:{label:"Día:",disabled:disabled}},{className:"col-md-2",key:"mes",type:"select",templateOptions:{label:"Mes:",options:[{value:1,name:"Enero"},{value:2,name:"Febrero"},{value:3,name:"Marzo"},{value:4,name:"Abril"},{value:5,name:"Mayo"},{value:6,name:"Junio"},{value:7,name:"Julio"},{value:8,name:"Agosto"},{value:9,name:"Setiembre"},{value:10,name:"Octubre"},{value:11,name:"Novienbre"},{value:12,name:"Diciembre"}]}}]},{key:"glosa",type:"input",templateOptions:{label:"Glosa:",disabled:disabled}}];return fields},service={getFormFields:getFormFields};return service}angular.module("feriados").factory("FeriadosForm",factory)}(),angular.module("fichas").run(["Menus",function(Menus){Menus.addMenuItem("topbar","Fichas","fichas","dropdown","/fichas(/create)?"),Menus.addSubMenuItem("topbar","fichas","Nueva Ficha","fichas/create"),Menus.addSubMenuItem("topbar","fichas","Buscar Ficha","fichas"),Menus.addSubMenuItem("topbar","fichas","Reporte de Marcas","fichas/reporte/1")}]),angular.module("fichas").config(["$stateProvider",function($stateProvider){$stateProvider.state("listFichas",{url:"/fichas",templateUrl:"modules/fichas/views/list-fichas.client.view.html"}).state("createFicha",{url:"/fichas/create",templateUrl:"modules/fichas/views/create-ficha.client.view.html"}).state("viewFicha",{url:"/fichas/:fichaId",templateUrl:"modules/fichas/views/view-ficha.client.view.html"}).state("editFicha",{url:"/fichas/:fichaId/edit",templateUrl:"modules/fichas/views/edit-ficha.client.view.html"}).state("editFechaFicha",{url:"/fichas/:fichaId/fecha",templateUrl:"modules/fichas/views/editfecha-ficha.client.view.html"}).state("report1Ficha",{url:"/fichas/reporte/1",templateUrl:"modules/fichas/views/reporte1-ficha.client.view.html"}).state("vencimientoFicha",{url:"/fichavencimiento",templateUrl:"modules/fichas/views/list-venc.client.view.html"})}]),angular.module("fichas").controller("FichasController",["$scope","$stateParams","$location","$resource","Authentication","Fichas","TableSettings","FichasForm","ClientesBusq","Derechos","Tramites","Clases","Subclases","$timeout","Upload","ParametrosCod","Fecvens","TitularsBusq",function($scope,$stateParams,$location,$resource,Authentication,Fichas,TableSettings,FichasForm,ClientesBusq,Derechos,Tramites,Clases,SubClases,$timeout,Upload,ParametrosCod,Fecvens,TitularsBusq){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Fichas,"ficha"),$scope.ficha={},$scope.buscandoFichas=!1,$scope.setFormFields=function(disabled){$scope.formFields=FichasForm.getFormFields(disabled)},$scope.uploadPic=function(file,cliente,titular){cliente&&($scope.ficha.codcli=cliente.codigo,$scope.ficha.nomcli=cliente.nombre);var ficha=new Fichas($scope.ficha);ficha.derecho=$scope.derecho._id,ficha.tramite=$scope.tramite._id,ficha.clases=[],$scope.ficha.subclases&&$scope.ficha.subclases.forEach(function(item){ficha.clases.indexOf(item.clase)<0&&ficha.clases.push(item.clase)}),console.log("uploadpic:",ficha),file?(console.log("uploadPic:file.name",file.name),file.upload=Upload.upload({url:"fichaupload",fields:ficha,file:file}),file.upload.then(function(response){$timeout(function(){file.result=response.data,$location.path("fichas")})},function(response){console.log("response: ",response),response.status>0&&($scope.error=response.status+": "+(response.data?response.data.message:response.message))}),file.upload.progress(function(evt){file.progress=Math.min(100,parseInt(100*evt.loaded/evt.total))})):ficha._id?ficha.$update(function(){$location.path("fichas")},function(response){console.log("response err:",response),response.status>0&&($scope.error=response.status+": "+(response.data?response.data.message:response.message))}):ficha.$save(function(response){$location.path("fichas")},function(err){err.data?$scope.error=err.data.message:$scope.error=err.message})},$scope.borrarimagen=function(){$scope.picFile=null},$scope.update=function(){var ficha=$scope.ficha;ficha.derecho=$scope.derecho._id,ficha.tramite=$scope.tramite._id,ficha.$update(function(){$location.path("fichas")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(ficha){ficha?ficha=Fichas.get({fichaId:ficha._id},function(){ficha.$remove(function(){$scope.tableParams.reload()})}):$scope.ficha.$remove(function(){$location.path("fichas")})},$scope.toViewFicha=function(){$scope.ficha=Fichas.get({fichaId:$stateParams.fichaId}),$scope.setFormFields(!0)},$scope.toCreateFicha=function(){$scope.ficha={},$scope.derecho={_id:null},$scope.derechos=Derechos.query({all:!0}),$scope.tramite={_id:null},$scope.tramites=Tramites.query({all:!0}),$scope.clases=Clases.query(),$scope.subclase={}},$scope.toEditFicha=function(){$scope.clases=Clases.query(),$scope.subclase={},$scope.ficha=Fichas.get({fichaId:$stateParams.fichaId},function(ficha){$scope.derecho=ficha.derecho||{_id:null},$scope.derechos=Derechos.query({all:!0}),$scope.tramite=ficha.tramite||{_id:null},$scope.tramites=Tramites.query({all:!0}),$scope.cliente={codigo:ficha.codcli,nombre:ficha.nomcli}})},$scope.changeClase=function(unaClase){$scope.subclases=[],$scope.subclase=[],Clases.query({claseId:unaClase},function(lista){var i=0;lista&&lista.forEach(function(lis){var ele={id:i++,label:lis.codigo+"-"+lis.name,clase:lis.clase,codigo:lis.codigo};$scope.subclases.push(ele),$scope.ficha.subclases&&$scope.ficha.subclases.forEach(function(cadasub){cadasub.clase===lis.clase&&cadasub.codigo===lis.codigo&&$scope.subclase.push(ele)})})})},$scope.toEditFecha=function(){var Fich=$resource("fichas/fecha/:idFicha",{idFicha:"@_id"});Fich.get({idFicha:$stateParams.fichaId},function(ficha){void 0===ficha.fechas&&(ficha.fechas={fecpre:null}),$scope.ficha=ficha})},$scope.uploadFechas=function(){var ficha=new Fichas($scope.ficha);console.log("uploadFechas:",ficha);var Fich=$resource("fichas/fecha/:idFicha",null,{update:{method:"PUT"}});Fich.update({idFicha:ficha._id},ficha,function(ficha){$location.path("fichas")},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.iniList=function(){$scope.clases=Clases.query();var param=$scope.tableParams.parameters();param.query&&($scope.query=param.query)},$scope.doQuery=function(){var param=$scope.tableParams.parameters();param.query=$scope.query,param.page=1,console.log("param:",param),$scope.tableParams.parameters(param),$scope.tableParams.reload()},$scope.queryVencFecha=function(fecha1,fecha2){(!fecha2||fecha1>fecha2)&&($scope.query?$scope.query.vencfecha2=fecha1:$scope.query={vencfecha2:fecha1}),$scope.doQuery()},$scope.queryVencFecha2=function(fecha1,fecha2){(!fecha1||fecha1>fecha2)&&($scope.query?$scope.query.vencfecha1=fecha2:$scope.query={vencfecha1:fecha2}),$scope.doQuery()},$scope.iniVenc=function(){var venc=$resource("fichavencimiento",{});venc.query({},function(fichas){$scope.fichas=fichas},function(error){$scope.error=error.data.message})},$scope.descartar=function(fichaFecha){var UpdDescarte=$resource("fichas/:codFicha/venc/:descarte",{codFicha:"@codigo",descarte:"@descarte"}),updDescarte=new UpdDescarte(fichaFecha);updDescarte.$save(function(){for(var i=0;i<$scope.fichas.length;i++)if($scope.fichas[i].codigo===fichaFecha.codigo){$scope.fichas.splice(i,1);break}},function(error){$scope.error=error.data.message})},$scope.iniReporte=function(){$scope.ficha={codcli:"",nomcli:""},$scope.tiposDeFecha=Fecvens.query(),$scope.desde=new Date,$scope.desde.setHours(0,0,0,0),$scope.hasta=new Date,$scope.hasta.setHours(0,0,0,0),$scope.tipoFecha="fecpub",$scope.modoReporte=!1},$scope.changeDesde=function(){$scope.desde>$scope.hasta&&($scope.hasta=$scope.desde)},$scope.reporte1=function(){if($scope.error="",$scope.desde>$scope.hasta)return void($scope.error="Fecha desde no puede mayor que fecha hasta");var rep1=$resource("fichas/reporte/1",{}),codcli=null;$scope.cliente&&(codcli=$scope.cliente.codigo),rep1.query({codcli:codcli,tipoFecha:$scope.tipoFecha,desde:$scope.desde,hasta:$scope.hasta},function(result){for(var i in $scope.tiposDeFecha)if($scope.tiposDeFecha[i].campo===$scope.tipoFecha){$scope.tituloReporte=$scope.tiposDeFecha[i].descripcion;break}$scope.result=result},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.changeFecpre=function(){ParametrosCod.get({parametroCod:"01",fecha:$scope.ficha.fechas.fecpre},function(obj){$scope.ficha.fechas.fecnoti=obj.fecha})},$scope.changePub=function(){ParametrosCod.get({parametroCod:"02",fecha:$scope.ficha.fechas.fecpub},function(obj){$scope.ficha.fechas.fecvencplazo=obj.fecha,$scope.ficha.fechas.fecpubDescarte=!1})},$scope.changeFecOrdPub=function(){ParametrosCod.get({parametroCod:"10",fecha:$scope.ficha.fechas.fecordpub},function(obj){$scope.ficha.fechas.fecvencplapub=obj.fecha})},$scope.change_fecnotopo=function(){ParametrosCod.get({parametroCod:"03",fecha:$scope.ficha.fechas.fecnotopo},function(obj){$scope.ficha.fechas.fecplazocont=obj.fecha})},$scope.change_fecnotresol=function(){ParametrosCod.get({parametroCod:"04",fecha:$scope.ficha.fechas.fecnotresol},function(obj){$scope.ficha.fechas.fecplareco=obj.fecha}),ParametrosCod.get({parametroCod:"05",fecha:$scope.ficha.fechas.fecnotresol},function(obj){$scope.ficha.fechas.fecvencplaape=obj.fecha})},$scope.change_fecnotresoreco=function(){ParametrosCod.get({parametroCod:"06",fecha:$scope.ficha.fechas.fecnotresoreco},function(obj){$scope.ficha.fechas.fecvencplaape=obj.fecha}),ParametrosCod.get({parametroCod:"07",fecha:$scope.ficha.fechas.fecnotresoreco},function(obj){$scope.ficha.fechas.fecvencplazdem=obj.fecha})},$scope.setclase={smartButtonMaxItems:10,scrollableHeight:"250px",scrollable:!0},$scope.setsubclase={smartButtonMaxItems:10,scrollableHeight:"250px",scrollable:!0,externalIdProp:"",smartButtonTextConverter:function(itemText,originalItem){return itemText.substring(0,2)}},$scope.setsubclaseevent={onItemSelect:function(item){$scope.ficha.subclases||($scope.ficha.subclases=[]),$scope.ficha.subclases.push({clase:item.clase,codigo:item.codigo,label:item.label.substring(3)}),$scope.ficha.subclases.sort(function(a,b){var cmp=a.clase.localeCompare(b.clase);return 0===cmp&&(cmp=a.codigo.localeCompare(b.codigo)),
cmp})},onItemDeselect:function(item){if($scope.subclases){for(var itemx=$scope.subclases[item.id],sc=$scope.ficha.subclases,pos=-1,i=0;i<sc.length;i++)if(sc[i].clase===itemx.clase&&sc[i].codigo===itemx.codigo){pos=i;break}pos>=0&&sc.splice(pos,1)}},onDeselectAll:function(){if($scope.subclases&&0!==$scope.subclases.length)for(var itemx=$scope.subclases[0],sc=$scope.ficha.subclases,i=sc.length-1;i>=0;i--)sc[i].clase===itemx.clase&&sc.splice(i,1)}},$scope.borrarSubClase=function(item){for(var sc=$scope.ficha.subclases,i=0;i<sc.length;i++)if(sc[i].clase===item.clase&&sc[i].codigo===item.codigo){sc.splice(i,1);break}sc=$scope.subclase;for(var j=0;j<sc.length;j++)if(sc[j].clase===item.clase&&sc[j].codigo===item.codigo){sc.splice(j,1);break}},$scope.modelOptions={debounce:{"default":500,blur:250},getterSetter:!0},$scope.getCliente=function(valor){var promise=ClientesBusq.query({texto:valor,count:20});return promise.$promise.then(function(res){return res})},$scope.getTitular=function(valor){var promise=TitularsBusq.query({texto:valor,count:20});return promise.$promise.then(function(res){return res})},$scope.iralista=function(){$location.path("fichas")},$scope.creapdf=function(){console.log($scope.result);var docDefinition={content:[{table:{headerRows:1,widths:[50,100,100,100,100],body:[["Código","Marca","Clase","Logo","Certificado"]]},layout:{fillColor:function(rowIndex,node,columnIndex){return 0===rowIndex?"#FF7F00":null}}}],defaultStyle:{fontSize:10}};for(var ificha in $scope.result){var ficha=$scope.result[ificha],clase="";for(var cadaclase in ficha.clases)clase=""===clase?ficha.clases[cadaclase]:clase+", "+ficha.clases[cadaclase];var image="/img/"+ficha.archivo;ficha.archivo||(image=""),ficha.codigo&&docDefinition.content[0].table.body.push([ficha.codigo,ficha.nomsigno,clase,image,ficha.numcertificado||""])}console.log(docDefinition),pdfMake.createPdf(docDefinition).open(),pdfMake.createPdf(docDefinition)}}]),angular.module("fichas").factory("Fichas",["$resource",function($resource){return $resource("fichas/:fichaId",{fichaId:"@_id"},{update:{method:"PUT"}})}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{key:"codcli",type:"input",templateOptions:{label:"Codigo de Cliente:",disabled:disabled}}];return fields},service={getFormFields:getFormFields};return service}angular.module("fichas").factory("FichasForm",factory)}(),angular.module("parametros").config(["$stateProvider",function($stateProvider){$stateProvider.state("listParametros",{url:"/parametros",templateUrl:"modules/parametros/views/list-parametros.client.view.html"}).state("createParametro",{url:"/parametros/create",templateUrl:"modules/parametros/views/create-parametro.client.view.html"}).state("configParametro",{url:"/parametros/config",templateUrl:"modules/parametros/views/config-parametros.client.view.html"}).state("viewParametro",{url:"/parametros/:parametroId",templateUrl:"modules/parametros/views/view-parametro.client.view.html"}).state("editParametro",{url:"/parametros/:parametroId/edit",templateUrl:"modules/parametros/views/edit-parametro.client.view.html"})}]),angular.module("parametros").controller("ParametrosController",["$scope","$q","$stateParams","$location","Authentication","Parametros","TableSettings","ParametrosForm",function($scope,$q,$stateParams,$location,Authentication,Parametros,TableSettings,ParametrosForm){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Parametros),$scope.parametro={},$scope.setFormFields=function(disabled){$scope.formFields=ParametrosForm.getFormFields(disabled)},$scope.create=function(){var parametro=new Parametros($scope.parametro);parametro.$save(function(response){$location.path("parametros/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(parametro){parametro?parametro=Parametros.get({parametroId:parametro._id},function(){parametro.$remove(function(){$scope.tableParams.reload()})}):$scope.parametro.$remove(function(){$location.path("parametros")})},$scope.update=function(){var parametro=$scope.parametro;parametro.$update(function(){$location.path("parametros/"+parametro._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.updateParametros=function(parametros){$scope.error="";var promises=[];angular.forEach(parametros,function(param){if(param&&param.change&&"*"===param.change){var params=new Parametros(param),promise=params.$update();promises.push(promise)}}),$q.all(promises).then(function(data){console.log(data),$location.path("#!")},function(error){$scope.error=error.data.message})},$scope.find=function(){$scope.parametros=Parametros.query({all:!0})},$scope.change=function(param){param.change="*"},$scope.toViewParametro=function(){$scope.parametro=Parametros.get({parametroId:$stateParams.parametroId}),$scope.setFormFields(!0)},$scope.toEditParametro=function(){$scope.parametro=Parametros.get({parametroId:$stateParams.parametroId}),$scope.setFormFields(!1)}}]),angular.module("parametros").factory("Parametros",["$resource",function($resource){return $resource("parametros/:parametroId",{parametroId:"@_id"},{update:{method:"PUT"}})}]),angular.module("parametros").factory("ParametrosCod",["$resource",function($resource){return $resource("parametros/codigo/:parametroCod",{parametroId:"@codigo"},{update:{method:"PUT"}})}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{key:"codigo",type:"input",templateOptions:{label:"Código:",disabled:disabled}},{key:"desc",type:"input",templateOptions:{label:"Descripción;",disabled:disabled}},{key:"dias",type:"input",templateOptions:{label:"Días:",disabled:disabled}},{key:"diames",type:"radio",templateOptions:{label:"",disabled:disabled,options:[{name:"Dias:",value:"d"},{name:"Meses",value:"m"}]}},{key:"labo",type:"radio",templateOptions:{label:"",disabled:disabled,options:[{name:"Días laborables",value:"y"},{name:"Días no laborables",value:"n"}]}}];return fields},service={getFormFields:getFormFields};return service}angular.module("parametros").factory("ParametrosForm",factory)}(),angular.module("subclases").config(["$stateProvider",function($stateProvider){$stateProvider.state("listSubclases",{url:"/subclases",templateUrl:"modules/subclases/views/list-subclases.client.view.html"}).state("createSubclase",{url:"/subclases/create",templateUrl:"modules/subclases/views/create-subclase.client.view.html"}).state("viewSubclase",{url:"/subclases/:subclaseId",templateUrl:"modules/subclases/views/view-subclase.client.view.html"}).state("editSubclase",{url:"/subclases/:subclaseId/edit",templateUrl:"modules/subclases/views/edit-subclase.client.view.html"})}]),angular.module("subclases").controller("SubclasesController",["$scope","$stateParams","$location","Authentication","Subclases","TableSettings","SubclasesForm",function($scope,$stateParams,$location,Authentication,Subclases,TableSettings,SubclasesForm){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Subclases),$scope.subclase={},$scope.setFormFields=function(disabled){$scope.formFields=SubclasesForm.getFormFields(disabled)},$scope.create=function(){var subclase=new Subclases($scope.subclase);subclase.$save(function(response){$location.path("subclases/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(subclase){subclase?subclase=Subclases.get({subclaseId:subclase._id},function(){subclase.$remove(function(){$scope.tableParams.reload()})}):$scope.subclase.$remove(function(){$location.path("subclases")})},$scope.update=function(){var subclase=$scope.subclase;subclase.$update(function(){$location.path("subclases/"+subclase._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.toViewSubclase=function(){$scope.subclase=Subclases.get({subclaseId:$stateParams.subclaseId}),$scope.setFormFields(!0)},$scope.toEditSubclase=function(){$scope.subclase=Subclases.get({subclaseId:$stateParams.subclaseId}),$scope.setFormFields(!1)}}]),angular.module("subclases").factory("Subclases",["$resource",function($resource){return $resource("subclases/:subclaseId",{subclaseId:"@_id"},{update:{method:"PUT"}})}]),angular.module("subclases").factory("Clases",["$resource",function($resource){return $resource("clases/:claseId",{})}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{className:"row",fieldGroup:[{className:"col-md-1",key:"clase",type:"input",templateOptions:{label:"Clase:",disabled:disabled}},{className:"col-md-1",key:"codigo",type:"input",templateOptions:{label:"SubClase:",disabled:disabled}}]},{key:"name",type:"input",templateOptions:{label:"Nombre:",disabled:disabled}}];return fields},service={getFormFields:getFormFields};return service}angular.module("subclases").factory("SubclasesForm",factory)}(),angular.module("titulars").config(["$stateProvider",function($stateProvider){$stateProvider.state("listtitulars",{url:"/titulars",templateUrl:"modules/titulars/views/list-titulars.client.view.html"}).state("createtitular",{url:"/titulars/create",templateUrl:"modules/titulars/views/create-titular.client.view.html"}).state("viewtitular",{url:"/titulars/:titularId",templateUrl:"modules/titulars/views/view-titular.client.view.html"}).state("edittitular",{url:"/titulars/:titularId/edit",templateUrl:"modules/titulars/views/edit-titular.client.view.html"})}]),angular.module("titulars").controller("TitularsController",["$scope","$stateParams","$location","Authentication","Titulars","TableSettings","TitularsForm",function($scope,$stateParams,$location,Authentication,Titulars,TableSettings,TitularsForm){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Titulars),$scope.titular={},$scope.setFormFields=function(disabled){$scope.formFields=TitularsForm.getFormFields(disabled)},$scope.create=function(){var titular=new Titulars($scope.titular);titular.$save(function(response){$location.path("titulars/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(titular){titular?titular=Titulars.get({titularId:titular._id},function(){titular.$remove(function(){$scope.tableParams.reload()})}):$scope.titular.$remove(function(){$location.path("titulars")})},$scope.update=function(){var titular=$scope.titular;titular.$update(function(){$location.path("titulars/"+titular._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.toViewTitular=function(){$scope.titular=Titulars.get({titularId:$stateParams.titularId}),$scope.setFormFields(!0)},$scope.toEditTitular=function(){$scope.titular=Titulars.get({titularId:$stateParams.titularId}),$scope.setFormFields(!1)},$scope.iniList=function(){$scope.tableParams.parameters({filter:{}})}}]),angular.module("titulars").factory("Titulars",["$resource",function($resource){return $resource("titulars/:titularId",{titularId:"@_id"},{update:{method:"PUT"}})}]).directive("dateInput",["dateFilter",function(dateFilter){return{require:"ngModel",template:'<input type="date" class="form-control"></input>',replace:!0,link:function(scope,elm,attrs,ngModelCtrl){ngModelCtrl.$formatters.unshift(function(modelValue){return dateFilter(modelValue,"yyyy-MM-dd")}),ngModelCtrl.$parsers.push(function(modelValue){return angular.toJson(modelValue,!0).substring(1,angular.toJson(modelValue).length-1)})}}}]),angular.module("titulars").factory("TitularsCod",["$resource",function($resource){return $resource("titulars/codigo/:codcli",{codcli:"@codigo"})}]),angular.module("titulars").factory("TitularsBusq",["$resource",function($resource){return $resource("titulars/busq/:texto")}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{className:"row",fieldGroup:[{className:"col-md-2 upper-case",key:"codigo",type:"input",templateOptions:{label:"(*) Código:",disabled:disabled}},{className:"col-md-4 upper-case",key:"nombre",type:"input",templateOptions:{label:"(*) Nombre:",disabled:disabled}},{className:"col-md-2",key:"ruc",type:"input",templateOptions:{label:"Ruc:",disabled:disabled}}]},{key:"direccion",type:"input",templateOptions:{label:"Dirección:",disabled:disabled}},{className:"section-label",template:"<div><strong>UBICACIÓN:</strong></div>"},{className:"row",fieldGroup:[{className:"col-md-2",key:"distrito",type:"input",templateOptions:{label:"Distrito:",disabled:disabled}},{className:"col-md-2",key:"provincia",type:"input",templateOptions:{label:"Pronvicia:",disabled:disabled}},{className:"col-md-2",key:"departamen",type:"input",templateOptions:{label:"Departamento:",disabled:disabled}},{className:"col-md-2",key:"pais",type:"input",templateOptions:{label:"País:",disabled:disabled}}]},{className:"row",fieldGroup:[{className:"col-md-2",key:"telefono",type:"input",templateOptions:{label:"Teléfono:",disabled:disabled}},{className:"col-md-2",key:"fax",type:"input",templateOptions:{label:"Fax:",disabled:disabled}}]},{className:"row",fieldGroup:[{className:"col-md-2",key:"propietari",type:"input",templateOptions:{label:"Propietario:",disabled:disabled}},{className:"col-md-3",key:"e_mail",type:"input",templateOptions:{label:"Email:",disabled:disabled}}]}];return fields},service={getFormFields:getFormFields};return service}angular.module("titulars").factory("TitularsForm",factory)}(),angular.module("tramites").config(["$stateProvider",function($stateProvider){$stateProvider.state("listTramites",{url:"/tramites",templateUrl:"modules/tramites/views/list-tramites.client.view.html"}).state("createTramite",{url:"/tramites/create",templateUrl:"modules/tramites/views/create-tramite.client.view.html"}).state("viewTramite",{url:"/tramites/:tramiteId",templateUrl:"modules/tramites/views/view-tramite.client.view.html"}).state("editTramite",{url:"/tramites/:tramiteId/edit",templateUrl:"modules/tramites/views/edit-tramite.client.view.html"})}]),angular.module("tramites").controller("TramitesController",["$scope","$stateParams","$location","Authentication","Tramites","TableSettings","TramitesForm",function($scope,$stateParams,$location,Authentication,Tramites,TableSettings,TramitesForm){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Tramites),$scope.tramite={},$scope.setFormFields=function(disabled){$scope.formFields=TramitesForm.getFormFields(disabled)},$scope.create=function(){var tramite=new Tramites($scope.tramite);tramite.$save(function(response){$location.path("tramites/"+response._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(tramite){tramite?tramite=Tramites.get({tramiteId:tramite._id},function(){tramite.$remove(function(){$scope.tableParams.reload()})}):$scope.tramite.$remove(function(){$location.path("tramites")})},$scope.update=function(){var tramite=$scope.tramite;tramite.$update(function(){$location.path("tramites/"+tramite._id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.toViewTramite=function(){$scope.tramite=Tramites.get({tramiteId:$stateParams.tramiteId}),$scope.setFormFields(!0)},$scope.toEditTramite=function(){$scope.tramite=Tramites.get({tramiteId:$stateParams.tramiteId}),$scope.setFormFields(!1)}}]),angular.module("tramites").factory("Tramites",["$resource",function($resource){return $resource("tramites/:tramiteId",{tramiteId:"@_id"},{update:{method:"PUT"}})}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{key:"codigo",type:"input",templateOptions:{label:"Código",disabled:disabled}},{key:"name",type:"input",templateOptions:{label:"Nombre:",disabled:disabled}}];return fields},service={getFormFields:getFormFields};return service}angular.module("tramites").factory("TramitesForm",factory)}(),angular.module("ubis").config(["$stateProvider",function($stateProvider){$stateProvider.state("listUbis",{url:"/ubis",templateUrl:"modules/ubis/views/list-ubis.client.view.html"}).state("createUbi",{url:"/ubis/:ubiId/:ubiNiv/create",templateUrl:"modules/ubis/views/create-ubi.client.view.html"}).state("viewUbi",{url:"/ubis/:ubiId",templateUrl:"modules/ubis/views/list-ubis.client.view.html"}).state("editUbi",{url:"/ubis/:ubiId/edit",templateUrl:"modules/ubis/views/edit-ubi.client.view.html"})}]),angular.module("ubis").controller("UbisController",["$scope","$stateParams","$location","Authentication","Ubis","TableSettings","UbisForm",function($scope,$stateParams,$location,Authentication,Ubis,TableSettings,UbisForm){$scope.authentication=Authentication,$scope.tableParams=TableSettings.getParams(Ubis),$scope.ubi={},$scope.nivel="",$scope.setFormFields=function(disabled){$scope.formFields=UbisForm.getFormFields(disabled)},$scope.create=function(){var ubi=new Ubis($scope.ubi);ubi.pad=$stateParams.ubiId||0,ubi.niv=$stateParams.ubiNiv||0,ubi.$save(function(response){$location.path("ubis/"+response.pad)},function(errorResponse){$scope.error=errorResponse.data.message})};var getNivel=function(niv){return 0===niv?"País":1===niv?"Departamento":2===niv?"Provincia":3===niv?"Distrito":""};$scope.remove=function(ubi){ubi?ubi=Ubis.get({ubiId:ubi.num},function(){var x=ubi.$remove();x.then(function(u){$scope.tableParams.reload()})}):$scope.ubi.$remove(function(){$location.path("ubis")})},$scope.update=function(){var ubi=$scope.ubi;ubi.$update(function(){$location.path("ubis/"+ubi.num)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.toViewUbi=function(){0===$stateParams.ubiId?($scope.ubi={},$scope.tableParams.parameters({num:0}),$scope.nivel=""):$scope.ubi=Ubis.get({ubiId:$stateParams.ubiId},function(ubi){$scope.nivel=getNivel(ubi.niv),$scope.tableParams.parameters({num:ubi.num,page:1,filter:{}})}),$scope.setFormFields(!0)},$scope.toEditUbi=function(){$scope.ubi=Ubis.get({ubiId:$stateParams.ubiId}),$scope.setFormFields(!1)},$scope.toCreateUbi=function(){$scope.setFormFields(!1)}}]),angular.module("ubis").factory("Ubis",["$resource",function($resource){return $resource("ubis/:ubiId",{ubiId:"@num"},{update:{method:"PUT"}})}]),function(){function factory(){var getFormFields=function(disabled){var fields=[{key:"nom",type:"input",templateOptions:{label:"Nombre:",disabled:disabled}}];return fields},service={getFormFields:getFormFields};return service}angular.module("ubis").factory("UbisForm",factory)}(),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("profile",{url:"/settings/profile",templateUrl:"modules/users/views/settings/edit-profile.client.view.html"}).state("password",{url:"/settings/password",templateUrl:"modules/users/views/settings/change-password.client.view.html"}).state("accounts",{url:"/settings/accounts",templateUrl:"modules/users/views/settings/social-accounts.client.view.html"}).state("signup",{url:"/signup",templateUrl:"modules/users/views/authentication/signup.client.view.html"}).state("signin",{url:"/signin",templateUrl:"modules/users/views/authentication/signin.client.view.html"}).state("forgot",{url:"/password/forgot",templateUrl:"modules/users/views/password/forgot-password.client.view.html"}).state("reset-invalid",{url:"/password/reset/invalid",templateUrl:"modules/users/views/password/reset-password-invalid.client.view.html"}).state("reset-success",{url:"/password/reset/success",templateUrl:"modules/users/views/password/reset-password-success.client.view.html"}).state("reset",{url:"/password/reset/:token",templateUrl:"modules/users/views/password/reset-password.client.view.html"}).state("list",{url:"/users",templateUrl:"modules/users/views/authentication/list.client.view.html"})}]),angular.module("users").controller("AuthenticationController",["$scope","$http","$location","Authentication","Path",function($scope,$http,$location,Authentication,Path){$scope.authentication=Authentication,$scope.TableSettings=Path.getSettings("user"),$scope.config=Path.getConfig(),$scope.buscando=!1,$scope.signup=function(){$http.post("/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.signin=function(){$http.post("/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$location.path("/")}).error(function(response){$scope.error=response.message})},$scope.iniList=function(){$scope.doQuery("i")},$scope.doQuery=function(comando){$scope.error=null;var url={};"i"===comando?url=Path.getUrlTable({},$scope.config.count):"<"===comando?url=Path.getPrev():">"===comando?url=Path.getNext():"="===comando&&(url=Path.getEqual()),$http.get("/users",url).success(function(users){users.results&&0!==users.results.length||($scope.error="No se encontró registros con la condición ingresada"),$scope.buscando=!1,$scope.data=users,$scope.total={cant:users.total}}).error(function(errorResponse){errorResponse.data?$scope.error=errorResponse.data.message:$scope.error=errorResponse.message,$scope.buscando=!1}),$scope.buscando=!0},$scope.remove=function(usu){usu&&$http["delete"]("/users/"+usu._id).success(function(user){$scope.doQuery("=")}).error(function(errorResponse){$scope.error=errorResponse.data.message})}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication",function($scope,$stateParams,$http,$location,Authentication){$scope.authentication=Authentication,$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(){$scope.success=$scope.error=null,$http.post("/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message})},$scope.resetUserPassword=function(){$scope.success=$scope.error=null,$http.post("/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message})}}]),angular.module("users").controller("SettingsController",["$scope","$http","$location","Users","Authentication",function($scope,$http,$location,Users,Authentication){$scope.user=Authentication.user,$scope.user||$location.path("/"),$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})},$scope.updateUserProfile=function(isValid){if(isValid){$scope.success=$scope.error=null;var user=new Users($scope.user);user.$update(function(response){$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}else $scope.submitted=!0},$scope.changeUserPassword=function(){$scope.success=$scope.error=null,$http.post("/users/password",$scope.passwordDetails).success(function(response){$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message})}}]),angular.module("users").factory("Authentication",[function(){var _this=this;return _this._data={user:window.user,modules:{reniec:!1,sunat:!1,essalud:!1,telefonica:!1}},_this._data}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("users",{},{update:{method:"PUT"}})}]);